<%= provide(:title, "#{@question.school.name}の質問と回答") %>
<div class="question-show background-blue" id="question--show">
  <%= render partial: 'question_show_page_link', locals: { params: @params, question: @question } %>
  <%= render 'shared/flash_message' %>
  <div class="question-show-field">
    <div class="question-content">
      <h2><%= @question.school.name %>の質問と回答</h2>
      <% if @question.solution == 0 %>
        <div class="solution solution-red">
          未回答
        </div>
      <% elsif @question.solution == 1 %>
        <div class="solution solution-orange">
          未解決
        </div>
      <% else %>
        <div class="solution solution-green">
          解決済み
        </div>
      <% end %>
      <%= render partial: 'question_show_question_box', locals: { question: @question, params: @params } %>
      <% unless @answers.size == 0 %>
        <span class="rotateY180">&#8629;</span>
        <span class="span-answer">回答</span>
      <% end %>
      <% @answers.each do |answer|%>
        <ul class="question-box answer-box">
          <div class="flex">
            <li>
              <%= link_to user_path(answer.user) do %>
                <% if answer.user.image.attached? %>
                  <%= image_tag answer.user.image.variant(resize: '30x30!'), class: "user-icon", alt: "ユーザーアイコン" %>
                <% else %>
                  <%= image_tag src='70b3dd52350bf605f1bb4078ef79c9b9.png', class: "user-icon-default", alt: "ユーザーアイコン" %>
                <% end %>
              <% end %>
            </li>
            <li class="question-user-name"><%= answer.user.name %></li>
          </div>
          <div id='<%= answer.id %>'>
            <li class="question-show-text auto-adjust answer-text"><%= simple_format(answer.content) %></li>
            <li class="question-time"><%= answer.updated_at.to_s(:datetime_jp) %></li>
            <% if user_signed_in? && (current_user == answer.user) %>
              <div class="question-show-buttons">
                <%= link_to "/answers/#{answer.id}/edit", method: :get, remote: true, class: "question-show-edit-button button" do %>
                  <i class="fa fa-pencil" aria-hidden="true"></i><span>編集する</span>
                <% end %>
                <%= link_to "削除する", answer_path(answer), method: :delete, data: {confirm: "回答を削除しますか？"}, class: "question-show-delete-button button" %>
              </div>
              <div class="question-show-hidden-point hidden-point-<%= answer.id %>"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></div>
              <div class="question-show-hidden-menu fade-out hidden-menu-<%= answer.id %>">
                <%= link_to "編集", "/answers/#{answer.id}/edit", method: :get, remote: true, class: "hover-underline" %>
                <%= link_to "削除", answer_path(answer), method: :delete, data: {confirm: "回答を削除しますか？"}, class: "hover-underline delete-button" %>
              </div>
            <% end %>
          </div>
        </ul>
      <% end %>
      <% if user_signed_in? %>
        <%= label :content, "回答欄", class: "label-answer" %>
        <div class="question-box answer-textarea-box">
          <%= form_with model: @answer, url: answers_path, local: true do |f| %>
            <%= render 'shared/error_messages', object: f.object %>
            <%= f.text_area :content, placeholder: "回答を入力してください", class: "resize10" %>

            <%= f.hidden_field :user_id, value: current_user.id %>
            <%= f.hidden_field :question_id, value: @question.id %>

            <%= f.submit '回答する', class: "submit-button" %>
          <% end %>
        </div>
        <% if current_user == @question.user %>
          <% if @question.solution == 0 || @question.solution == 1 %>
            <div class="question-box solution-box">
              <p>質問が解決したらボタンを押してください</p>
              <%= link_to "解決した", solved_path(question_id: @question.id), class: "button" %>
            </div>
          <% else %>
            <div class="question-box solution-box">
              <p>追加の質問がある場合にはボタンを押してください</p>
              <%= link_to "解決済み", solved_path(question_id: @question.id), class: "button unsolution" %>
            </div>
          <% end %>
        <% end %>
      <% end %>
      <%= link_to "戻る", questions_path(school_id: @question.school_id), class: "button" %>
    </div>
  </div>
</div>
